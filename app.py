from flask import Flask, jsonify, request
import xgboost
import numpy as np


app = Flask(__name__)


@app.route('/predict', methods=['POST'])
def predict():
    # Get the data from the POST request.
    data = request.get_json(force=True)

    # load xgboost model
    model = xgboost.XGBRegressor()
    model.load_model(r"./data/xgboost.model")

    try:
        # convert all elements in data.values to float
        query = [float(k) for k in data.values()]

        query = np.array(list(query)).reshape((1, -1))
        result = model.predict(query)
        return jsonify({'vulnerability': str(result[0]), 'status': 'success'})

    except:
        return jsonify({'status': 'Error occured'})


if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0')
